<!DOCTYPE html>
<html lang="en">

	<head>
		<%-include('components/head')%>
		<link rel="stylesheet" href="/public/stylesheets/login_register.css">
		<title>Login</title>
	</head>

	<body class="flex-box center vertical">

		<header>
			<nav>
				<%-include('components/back')%>
			</nav>
		</header>
		<main>
			<form action="#" method="post" class="input_form" id="login">
				<h1 class="heading">Login</h1>
				<div class="input_area  flex-box vertical">
					<%-include('components/input_field', {label:"Username", autocomplete:"nickname", type:"text"})%>
					<%- include('components/input_field', {label:"Password", type:"password", autocomplete:"current-password"}) %>
				</div>
				<input type="submit" value="Login" class="button" id="submit_button">
				<p>Don't have an account yet? <a href="/register">Register</a> now!</p>
			</form>
		</main>
	</body>

	<script>
		const submit = document.getElementById('submit_button');
		const username = document.getElementById('username');
		const feedback = document.getElementById('lable_username');
		const input_field = document.getElementById('input_field_username');

		username.addEventListener('input', () => {
			const inputValue = username.value.trim();
			if(inputValue) {
				fetch('./api/user/available/' + inputValue)
					.then((res) => res.json())
					.then((data) => {
						if(data) {
							submit.setAttribute('disabled', 'true');
							input_field.className = 'input_field unavailable';
							feedback.textContent = 'Username does not Exist';
						} else {
							submit.removeAttribute('disabled', 'false');
							input_field.className = 'input_field';
							feedback.textContent = 'Username';
						}
					})
					.catch((error) => {
						console.error('Error:', error);
					});

			} else {
				submit.setAttribute('disabled', 'true');
				feedback.textContent = 'Username';
				input_field.className = 'input_field';
			}

		});
	</script>

</html>